"use strict";(self["webpackChunkweek6"]=self["webpackChunkweek6"]||[]).push([[50],{1530:function(e,t,a){function l(e){return{all:e=e||new Map,on:function(t,a){var l=e.get(t);l?l.push(a):e.set(t,[a])},off:function(t,a){var l=e.get(t);l&&(a?l.splice(l.indexOf(a)>>>0,1):e.set(t,[]))},emit:function(t,a){var l=e.get(t);l&&l.slice().map((function(e){e(a)})),(l=e.get("*"))&&l.slice().map((function(e){e(t,a)}))}}}a.d(t,{Z:function(){return r}});const s=l();var r=s},5050:function(e,t,a){a.r(t),a.d(t,{default:function(){return G}});var l=a(6252),s=a(3577),r=a(9963);const o={class:"container py-5"},n=(0,l._)("h1",{class:"text-center"},"購物車",-1),i={key:0,class:"my-5 text-center"},d=(0,l.Uk)(" 購物車裡沒有東西！快去逛逛吧！！ "),c={key:1,class:"table align-middle"},u=(0,l._)("thead",null,[(0,l._)("tr",null,[(0,l._)("th",null,"品名"),(0,l._)("th",{class:"text-center"},"單價"),(0,l._)("th",{style:{width:"150px"}},"數量"),(0,l._)("th",{class:"text-end"},"合計")])],-1),m=["src","alt"],p={class:"text-center"},h={key:0},f={key:1},_={class:"input-group mb-3"},g=["onClick"],b=["onUpdate:modelValue","onChange"],v=["onClick"],y=["onClick","disabled"],C={class:"text-end"},w=(0,l._)("td",{colspan:"3",class:"text-end"},"總計",-1),k={class:"text-end"},x=(0,l._)("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),I={class:"text-end text-success"},V={class:"my-5"},D=(0,l._)("h3",{class:"text-center mb-3"},"訂購人資訊",-1),W={class:"row justify-content-center"},$={class:"mb-3"},L=(0,l._)("label",{for:"email",class:"form-label"},"Email",-1),q={class:"mb-3"},U=(0,l._)("label",{for:"name",class:"form-label"},"收件人姓名",-1),z={class:"mb-3"},O=(0,l._)("label",{for:"tel",class:"form-label"},"收件人電話",-1),Z={class:"mb-3"},j=(0,l._)("label",{for:"address",class:"form-label"},"收件人地址",-1),E={class:"mb-3"},P=(0,l._)("label",{for:"message",class:"form-label"},"留言",-1),S={class:"text-end"},F=["disabled"];function H(e,t,a,H,K,M){const T=(0,l.up)("loading"),Y=(0,l.up)("router-link"),A=(0,l.up)("field-component"),B=(0,l.up)("error-message"),G=(0,l.up)("form-component");return(0,l.wg)(),(0,l.iD)("div",o,[(0,l.Wm)(T,{active:K.isLoading},null,8,["active"]),n,0==K.cartData.carts.length?((0,l.wg)(),(0,l.iD)("div",i,[(0,l.Wm)(Y,{to:"/products"},{default:(0,l.w5)((()=>[d])),_:1})])):((0,l.wg)(),(0,l.iD)("table",c,[u,(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(K.cartData.carts,(e=>((0,l.wg)(),(0,l.iD)("tr",{key:e.id},[(0,l._)("td",null,[(0,l.Wm)(Y,{to:`/product/${e.product.id}`,class:"link-dark text-decoration-none d-flex align-items-center"},{default:(0,l.w5)((()=>[(0,l._)("img",{src:e.product.imageUrl,alt:e.product.title,height:"100",class:"mx-3"},null,8,m),(0,l._)("div",null,[(0,l._)("h5",null,(0,s.zw)(e.product.title),1),(0,l._)("p",null,(0,s.zw)(e.product.description),1)])])),_:2},1032,["to"])]),(0,l._)("td",p,[e.product.price===e.product.origin_price?((0,l.wg)(),(0,l.iD)("div",h,(0,s.zw)(e.price)+" 元 ",1)):((0,l.wg)(),(0,l.iD)("div",f,[(0,l._)("small",null,[(0,l._)("del",null,(0,s.zw)(e.product.origin_price)+" 元",1)]),(0,l._)("div",null,(0,s.zw)(e.product.price)+" 元",1)]))]),(0,l._)("td",null,[(0,l._)("div",_,[(0,l._)("button",{class:"btn btn-secondary",type:"button",onClick:t=>M.updateCartItem(e,-1)},"-",8,g),(0,l.wy)((0,l._)("input",{type:"number",onkeypress:"return (event.charCode == 8 || event.charCode == 0 || event.charCode == 13) ? null : event.charCode >= 48 && event.charCode <= 57",class:"form-control","onUpdate:modelValue":t=>e.qty=t,onChange:t=>M.updateCartItem(e,0)},null,40,b),[[r.nr,e.qty,void 0,{number:!0}]]),(0,l._)("button",{class:"btn btn-secondary",type:"button",onClick:t=>M.updateCartItem(e,1)},"+",8,v)]),(0,l._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:t=>M.removeCartItem(e.id),disabled:K.isLoadingItem===e.id}," 刪除 ",8,y)]),(0,l._)("td",C,(0,s.zw)(e.total),1)])))),128))]),(0,l._)("tfoot",null,[(0,l._)("tr",null,[w,(0,l._)("td",k,(0,s.zw)(K.cartData.total),1)]),(0,l._)("tr",null,[x,(0,l._)("td",I,(0,s.zw)(),1)])])])),(0,l._)("div",V,[D,(0,l._)("div",W,[(0,l.Wm)(G,{ref:"form",class:"col-md-6",onSubmit:M.createOrder},{default:(0,l.w5)((({errors:e})=>[(0,l._)("div",$,[L,(0,l.Wm)(A,{id:"email",name:"email",type:"email",class:(0,s.C_)(["form-control",{"is-invalid":e["email"]}]),rules:"email|required",placeholder:"請輸入 Email",modelValue:K.form.user.email,"onUpdate:modelValue":t[0]||(t[0]=e=>K.form.user.email=e)},null,8,["class","modelValue"]),(0,l.Wm)(B,{name:"email",class:"invalid-feedback"})]),(0,l._)("div",q,[U,(0,l.Wm)(A,{id:"name",name:"姓名",type:"text",class:(0,s.C_)(["form-control",{"is-invalid":e["姓名"]}]),placeholder:"請輸入姓名",rules:"required",modelValue:K.form.user.name,"onUpdate:modelValue":t[1]||(t[1]=e=>K.form.user.name=e)},null,8,["class","modelValue"]),(0,l.Wm)(B,{name:"姓名",class:"invalid-feedback"})]),(0,l._)("div",z,[O,(0,l.Wm)(A,{id:"tel",name:"電話",type:"tel",class:(0,s.C_)(["form-control",{"is-invalid":e["電話"]}]),placeholder:"請輸入電話",rules:M.isPhone,modelValue:K.form.user.tel,"onUpdate:modelValue":t[2]||(t[2]=e=>K.form.user.tel=e)},null,8,["class","rules","modelValue"]),(0,l.Wm)(B,{name:"電話",class:"invalid-feedback"})]),(0,l._)("div",Z,[j,(0,l.Wm)(A,{id:"address",name:"地址",type:"text",class:(0,s.C_)(["form-control",{"is-invalid":e["地址"]}]),placeholder:"請輸入地址",rules:"required",modelValue:K.form.user.address,"onUpdate:modelValue":t[3]||(t[3]=e=>K.form.user.address=e)},null,8,["class","modelValue"]),(0,l.Wm)(B,{name:"地址",class:"invalid-feedback"})]),(0,l._)("div",E,[P,(0,l.wy)((0,l._)("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":t[4]||(t[4]=e=>K.form.message=e)},null,512),[[r.nr,K.form.message]])]),(0,l._)("div",S,[(0,l._)("button",{type:"submit",class:"btn btn-danger",disabled:Object.keys(e).length>0||0===K.cartData.carts.length}," 送出訂單 ",8,F)])])),_:1},8,["onSubmit"])])])])}var K=a(7398),M=a.n(K),T=a(1530),Y={data(){return{cartData:{carts:[]},products:[],product:{},isLoading:!1,isLoadingItem:"",form:{user:{email:"",name:"",tel:"",address:""},message:""}}},components:{Loading:M()},methods:{getCart(){this.$http.get("https://vue3-course-api.hexschool.io/v2/api/yclu/cart").then((e=>{this.cartData=e.data.data,T.Z.emit("get-cart")})).catch((e=>{console.dir(e)}))},removeCartItem(e){this.isLoadingItem=e,this.$http.delete(`https://vue3-course-api.hexschool.io/v2/api/yclu/cart/${e}`).then((e=>{alert(e.data.message),this.getCart(),this.isLoadingItem=""})).catch((e=>{console.dir(e)}))},updateCartItem(e,t){if(e.qty+t===0)return void this.removeCartItem(e.id);if(e.qty+t<1||e.qty%1!==0)return void alert("輸入數量錯誤");const a={product_id:e.id,qty:e.qty+t};this.isLoadingItem=e.id,this.$http.put(`https://vue3-course-api.hexschool.io/v2/api/yclu/cart/${e.id}`,{data:a}).then((e=>{alert(e.data.message),this.getCart(),this.isLoadingItem=""})).catch((e=>{console.dir(e)}))},createOrder(){this.isLoading=!0,setTimeout((()=>{this.isLoading=!1}),1e3);const e={data:this.form};this.$http.post("https://vue3-course-api.hexschool.io/v2/api/yclu/order",e).then((e=>{alert(`${e.data.message}：訂單ID為${e.data.orderId}，總金額為${e.data.total}元`),this.$refs.form.resetForm(),this.form.message="",this.getCart()})).catch((e=>{console.dir(e)}))},isPhone(e){const t=/^(09)[0-9]{8}$/;return!!t.test(e)||"電話格式錯誤"}},mounted(){this.getCart()}},A=a(3744);const B=(0,A.Z)(Y,[["render",H]]);var G=B}}]);
//# sourceMappingURL=50.8a515a75.js.map